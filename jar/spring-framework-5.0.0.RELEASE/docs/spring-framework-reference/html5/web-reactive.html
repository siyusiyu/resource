<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Web on Reactive Stack</title>
<style>
@import url(https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #34302d; padding: 0; margin: 0; font-family: "Varela Round", sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #0b0a0a; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #548e2e; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #487a28; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Montserrat, sans-serif; font-weight: 400; font-style: normal; color: #34302d; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #867c74; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #34302d; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #34302d; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #34302d; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #6b625c; }

kbd { font-family: Monaco, Menlo, Consolas, "Courier New", monospace; display: inline-block; color: #34302d; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #191715; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: Montserrat, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #0b0a0a; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f1f1f1; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d7d7d7; margin-bottom: 1.25em; padding: 1.25em; background: #f1f1f1; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #34302d; padding: 1.25em; }

#footer-text { color: #cbcfd2; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #34302d; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #262321; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Varela Round", sans-serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: Montserrat, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d7d7d7; margin-bottom: 1.25em; padding: 1.25em; background: #f1f1f1; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #0b0a0a; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: whitesmoke; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #dddddd; -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: whitesmoke; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #0b0a0a; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #34302d; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #3f6a22; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #34302d; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.admonitionblock { border-left: 4px solid #6db33f; background-color: #ebf1e7; padding: 1.2em 0; margin: 30px 0; width: auto; }

#toc a:hover { text-decoration: underline; }

.admonitionblock > table { margin-bottom: 0; }
.admonitionblock > table td.content { border-left: none; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="spring-web-reactive" class="book toc2 toc-left">
<div id="header">
<h1>Web on Reactive Stack</h1>
<div class="details">
<span id="revnumber">version 5.0.0.RELEASE</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#webflux">1. Spring WebFlux</a>
<ul class="sectlevel2">
<li><a href="#webflux-introduction">1.1. Introduction</a>
<ul class="sectlevel3">
<li><a href="#webflux-new-framework">1.1.1. Why a new web framework?</a></li>
<li><a href="#webflux-why-reactive">1.1.2. Reactive: what and why?</a></li>
<li><a href="#webflux-reactive-api">1.1.3. Reactive API</a></li>
<li><a href="#webflux-programming-models">1.1.4. Programming models</a></li>
<li><a href="#webflux-framework-choice">1.1.5. Choosing a web framework</a></li>
<li><a href="#webflux-server-choice">1.1.6. Choosing a server</a></li>
<li><a href="#webflux-performance">1.1.7. Performance vs scale</a></li>
</ul>
</li>
<li><a href="#webflux-reactive-spring-web">1.2. Reactive Spring Web</a>
<ul class="sectlevel3">
<li><a href="#webflux-httphandler">1.2.1. HttpHandler</a></li>
<li><a href="#webflux-web-handler-api">1.2.2. WebHandler API</a></li>
<li><a href="#webflux-codecs">1.2.3. Codecs</a></li>
</ul>
</li>
<li><a href="#webflux-dispatcher-handler">1.3. The DispatcherHandler</a>
<ul class="sectlevel3">
<li><a href="#webflux-special-bean-types">1.3.1. Special bean types</a></li>
<li><a href="#webflux-dispatcher-handler-sequence">1.3.2. Processing sequence</a></li>
</ul>
</li>
<li><a href="#webflux-controller">1.4. Annotated Controllers</a>
<ul class="sectlevel3">
<li><a href="#webflux-ann-controller">1.4.1. @Controller declaration</a></li>
<li><a href="#webflux-ann-requestmapping">1.4.2. Mapping Requests</a>
<ul class="sectlevel4">
<li><a href="#webflux-ann-requestmapping-uri-templates">URI Patterns</a></li>
<li><a href="#webflux-ann-requestmapping-pattern-comparison">Pattern Comparison</a></li>
<li><a href="#webflux-ann-requestmapping-consumes">Consumable Media Types</a></li>
<li><a href="#webflux-ann-requestmapping-produces">Producible Media Types</a></li>
<li><a href="#webflux-ann-requestmapping-params-and-headers">Parameters and Headers</a></li>
<li><a href="#webflux-ann-requestmapping-head-options">HTTP HEAD, OPTIONS</a></li>
</ul>
</li>
<li><a href="#webflux-ann-methods">1.4.3. Handler methods</a>
<ul class="sectlevel4">
<li><a href="#webflux-ann-arguments">Method arguments</a></li>
<li><a href="#webflux-ann-return-types">Return values</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#webflux-fn">1.5. Functional Endpoints</a>
<ul class="sectlevel3">
<li><a href="#webflux-fn-handler-functions">1.5.1. HandlerFunction</a></li>
<li><a href="#webflux-fn-router-functions">1.5.2. RouterFunction</a></li>
<li><a href="#webflux-fn-running">1.5.3. Running a server</a></li>
<li><a href="#webflux-fn-handler-filter-function">1.5.4. HandlerFilterFunction</a></li>
</ul>
</li>
<li><a href="#webflux-config">1.6. WebFlux Java Config</a>
<ul class="sectlevel3">
<li><a href="#webflux-config-enable">1.6.1. Enable the configuration</a></li>
<li><a href="#webflux-config-customize">1.6.2. Configuration API</a></li>
<li><a href="#webflux-config-conversion">1.6.3. Conversion, formatting</a></li>
<li><a href="#webflux-config-validation">1.6.4. Validation</a></li>
<li><a href="#webflux-config-content-negotiation">1.6.5. Content type resolvers</a></li>
<li><a href="#webflux-config-message-codecs">1.6.6. HTTP message codecs</a></li>
<li><a href="#webflux-config-view-resolvers">1.6.7. View resolvers</a></li>
<li><a href="#webflux-config-static-resources">1.6.8. Static resources</a></li>
<li><a href="#webflux-config-path-matching">1.6.9. Path Matching</a></li>
<li><a href="#webflux-config-advanced-java">1.6.10. Advanced config mode</a></li>
</ul>
</li>
<li><a href="#webflux-client">1.7. WebClient</a>
<ul class="sectlevel3">
<li><a href="#webflux-client-retrieve">1.7.1. Retrieve</a></li>
<li><a href="#webflux-client-exchange">1.7.2. Exchange</a></li>
<li><a href="#webflux-client-body">1.7.3. Request body</a></li>
<li><a href="#webflux-client-builder">1.7.4. Builder options</a></li>
<li><a href="#webflux-client-filter">1.7.5. Filters</a></li>
</ul>
</li>
<li><a href="#webflux-reactive-libraries">1.8. Reactive Libraries</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This part of the documentation covers support for reactive stack, web applications built on a
<a href="http://www.reactive-streams.org/">Reactive Streams</a> API to run on top of non-blocking
servers such as Netty, Undertow, and Servlet 3.1+ containers. Individual chapters cover
<a href="#webflux-module">Spring WebFlux</a> and its <a href="#webflux-fn">functional programming model</a>.
For Servlet stack, web applications, to go <a href="web.html#spring-web">Web on Servlet Stack</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="webflux"><a class="anchor" href="#webflux"></a>1. Spring WebFlux</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="webflux-introduction"><a class="anchor" href="#webflux-introduction"></a>1.1. Introduction</h3>
<div class="paragraph">
<p>The original web framework included in the Spring Framework, Spring Web MVC, was purpose
built for the Servlet API and Servlet containers. The reactive stack, web framework,
Spring WebFlux, was added later in version 5.0. It is fully non-blocking, supports
<a href="http://www.reactive-streams.org/">Reactive Streams</a> back pressure, and runs on servers such as
Netty, Undertow, and Servlet 3.1+ containers.</p>
</div>
<div class="paragraph">
<p>Both web frameworks mirror the names of their source modules
<a href="https://github.com/spring-projects/spring-framework/tree/master/spring-webmvc">spring-webmvc</a> and
<a href="https://github.com/spring-projects/spring-framework/tree/master/spring-webflux">spring-webflux</a>
and co-exist side by side in the Spring Framework. Each module is optional.
Applications may use one or the other module, or in some cases both&#8201;&#8212;&#8201;e.g. Spring MVC controllers with the reactive <code>WebClient</code>.</p>
</div>
<div class="paragraph">
<p>In addition to the web framework, Spring WebFlux also provides a <a href="#webflux-client">WebClient</a> for
performing HTTP requests, a <code>WebTestClient</code> for testing web endpoints, and
also client and server reactive, WebSocket support.</p>
</div>
<div class="sect3">
<h4 id="webflux-new-framework"><a class="anchor" href="#webflux-new-framework"></a>1.1.1. Why a new web framework?</h4>
<div class="paragraph">
<p>Part of the answer is the need for a non-blocking web stack to handle concurrency with a
small number of threads and scale with less hardware resources. Servlet 3.1 did provide
an API for non-blocking I/O. However, using it leads away from the rest of the Servlet API
where contracts are synchronous (<code>Filter</code>, <code>Servlet</code>) or blocking (<code>getParameter</code>,
<code>getPart</code>). This was the motivation for a new common API to serve as a foundation across
any non-blocking runtime. That is important because of servers such as Netty that are well
established in the async, non-blocking space.</p>
</div>
<div class="paragraph">
<p>The other part of the answer is functional programming. Much like the addition of annotations
in Java 5 created opportunities&#8201;&#8212;&#8201;e.g. annotated REST controllers or unit tests, the addition
of lambda expressions in Java 8 created opportunities for functional APIs in Java.
This is a boon for non-blocking applications and continuation style APIs&#8201;&#8212;&#8201;as popularized
by <code>CompletableFuture</code> and <a href="http://reactivex.io/">ReactiveX</a>, that allow declarative
composition of asynchronous logic. At the programming model level Java 8 enabled Spring
WebFlux to offer functional web endpoints alongside with annotated controllers.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-why-reactive"><a class="anchor" href="#webflux-why-reactive"></a>1.1.2. Reactive: what and why?</h4>
<div class="paragraph">
<p>We touched on non-blocking and functional but why reactive and what do we mean?</p>
</div>
<div class="paragraph">
<p>The term "reactive" refers to programming models that are built around reacting to change&#8201;&#8212;&#8201;network component reacting to I/O events, UI controller reacting to mouse events, etc.
In that sense non-blocking is reactive because instead of being blocked we are now in the mode
of reacting to notifications as operations complete or data becomes available.</p>
</div>
<div class="paragraph">
<p>There is also another important mechanism that we on the Spring team associate with "reactive"
and that is non-blocking back pressure. In synchronous, imperative code, blocking calls
serve as a natural form of back pressure that forces the caller to wait. In non-blocking
code it becomes important to control the rate of events so that a fast producer does not
overwhelm its destination.</p>
</div>
<div class="paragraph">
<p>Reactive Streams is a
<a href="https://github.com/reactive-streams/reactive-streams-jvm/blob/v1.0.1/README.md#specification">small spec</a>,
also <a href="http://download.java.net/java/jdk9/docs/api/java/util/concurrent/Flow.html">adopted</a> in Java 9,
that defines the interaction between asynchronous components with back pressure.
For example a data repository&#8201;&#8212;&#8201;acting as
<a href="http://www.reactive-streams.org/reactive-streams-1.0.1-javadoc/org/reactivestreams/Publisher.html">Publisher</a>,
can produce data that an HTTP server&#8201;&#8212;&#8201;acting as
<a href="http://www.reactive-streams.org/reactive-streams-1.0.1-javadoc/org/reactivestreams/Subscriber.html">Subscriber</a>,
can then write to the response. The main purpose of Reactive Streams is to allow the
subscriber to control how fast or how slow the publisher will produce data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Common question: what if a publisher can&#8217;t slow down?</strong><br>
The purpose of Reactive Streams is only to establish the mechanism and a boundary.
If a publisher can&#8217;t slow down then it has to decide whether to buffer, drop, or fail.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="webflux-reactive-api"><a class="anchor" href="#webflux-reactive-api"></a>1.1.3. Reactive API</h4>
<div class="paragraph">
<p>Reactive Streams plays an important role for interoperability. It is of interest to libraries
and infrastructure components but less useful as an application API because it is too
low level. What applications need is a higher level and richer, functional API to
compose async logic&#8201;&#8212;&#8201;similar to the Java 8 <code>Stream</code> API but not only for collections.
This is the role that reactive libraries play.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/reactor/reactor">Reactor</a> is the reactive library of choice for
Spring WebFlux. It provides the
<a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a> and
<a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> API types
to work on data sequences of 0..1 and 0..N through a rich set of operators aligned with the
ReactiveX <a href="http://reactivex.io/documentation/operators.html">vocabulary of operators</a>.
Reactor is a Reactive Streams library and therefore all of its operators support non-blocking back pressure.
Reactor has a strong focus on server-side Java. It is developed in close collaboration
with Spring.</p>
</div>
<div class="paragraph">
<p>WebFlux requires Reactor as a core dependency but it is interoperable with other reactive
libraries via Reactive Streams. As a general rule WebFlux APIs accept a plain <code>Publisher</code>
as input, adapt it to Reactor types internally, use those, and then return either
<code>Flux</code> or <code>Mono</code> as output. So you can pass any <code>Publisher</code> as input and you can apply
operations on the output, but you&#8217;ll need to adapt the output for use with another reactive library.
Whenever feasible&#8201;&#8212;&#8201;e.g. annotated controllers, WebFlux adapts transparently to the use
of RxJava or other reactive library. See <a href="#webflux-reactive-libraries">Reactive Libraries</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-programming-models"><a class="anchor" href="#webflux-programming-models"></a>1.1.4. Programming models</h4>
<div class="paragraph">
<p>The <code>spring-web</code> module contains the reactive foundation that underlies Spring WebFlux&#8201;&#8212;&#8201;HTTP abstractions, Reactive Streams server adapters, reactive codecs, and a
core Web API whose role is comparable to the Servlet API but with non-blocking semantics.</p>
</div>
<div class="paragraph">
<p>On that foundation Spring WebFlux provides a choice of two programming models:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#webflux-controller">Annotated Controllers</a>&#8201;&#8212;&#8201;consistent with Spring MVC, and based on the same annotations
from the <code>spring-web</code> module. Both Spring MVC and WebFlux controllers support reactive
(Reactor, RxJava) return types and as a result it is not easy to tell them apart. One notable
difference is that WebFlux also supports reactive <code>@RequestBody</code> arguments.</p>
</li>
<li>
<p><a href="#webflux-fn">Functional Endpoints</a>&#8201;&#8212;&#8201;lambda-based, lightweight, functional programming model. Think of
this as a small library or a set of utilities that an application can use to route and
handle requests. The big difference with annotated controllers is that the application
is in charge of request handling from start to finish vs declaring intent through
annotations and being called back.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="webflux-framework-choice"><a class="anchor" href="#webflux-framework-choice"></a>1.1.5. Choosing a web framework</h4>
<div class="paragraph">
<p>Should you use Spring MVC or WebFlux? Let&#8217;s cover a few different perspectives.</p>
</div>
<div class="paragraph">
<p>If you have a Spring MVC application that works fine, there is no need to change.
Imperative programming is the easiest way to write, understand, and debug code.
You have maximum choice of libraries since historically most are blocking.</p>
</div>
<div class="paragraph">
<p>If you are already shopping for a non-blocking web stack, Spring WebFlux offers the same
execution model benefits as others in this space and also provides a choice of servers&#8201;&#8212;&#8201;Netty, Tomcat, Jetty, Undertow, Servlet 3.1+ containers, a choice of programming models&#8201;&#8212;&#8201;annotated controllers and functional web endpoints, and a choice of reactive libraries&#8201;&#8212;&#8201;Reactor, RxJava, or other.</p>
</div>
<div class="paragraph">
<p>If you are interested in a lightweight, functional web framework for use with Java 8 lambdas
or Kotlin then use the Spring WebFlux functional web endpoints. That can also be a good choice
for smaller applications or microservices with less complex requirements that can benefit
from greater transparency and control.</p>
</div>
<div class="paragraph">
<p>In a microservice architecture you can have a mix of applications with either Spring MVC
or Spring WebFlux controllers, or with Spring WebFlux functional endpoints. Having support
for the same annotation-based programming model in both frameworks makes it easier to
re-use knowledge while also selecting the right tool for the right job.</p>
</div>
<div class="paragraph">
<p>A simple way to evaluate an application is to check its dependencies. If you have blocking
persistence APIs (JPA, JDBC), or networking APIs to use, then Spring MVC is the best choice
for common architectures at least. It is technically feasible with both Reactor and
RxJava to perform blocking calls on a separate thread but you wouldn&#8217;t be making the
most of a non-blocking web stack.</p>
</div>
<div class="paragraph">
<p>If you have a Spring MVC application with calls to remote services, try the reactive <code>WebClient</code>.
You can return reactive types (Reactor, RxJava, <a href="#webflux-reactive-libraries">or other</a>)
directly from Spring MVC controller methods. The greater the latency per call, or the
interdependency among calls, the more dramatic the benefits. Spring MVC controllers
can call other reactive components too.</p>
</div>
<div class="paragraph">
<p>If you have a large team, keep in mind the steep learning curve in the shift to non-blocking,
functional, and declarative programming. A practical way to start without a full switch
is to use the reactive <code>WebClient</code>. Beyond that start small and measure the benefits.
We expect that for a wide range of applications the shift is unnecessary.</p>
</div>
<div class="paragraph">
<p>If you are unsure what benefits to look for, start by learning about how non-blocking I/O
works (e.g. concurrency on single-threaded Node.js is not an oxymoron) and its effects.
The tag line is "scale with less hardware" but that effect is not guaranteed, not without
some network I/O that can be slow or unpredictable. This Netflix
<a href="https://medium.com/netflix-techblog/zuul-2-the-netflix-journey-to-asynchronous-non-blocking-systems-45947377fb5c">blog post</a>
is a good resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-server-choice"><a class="anchor" href="#webflux-server-choice"></a>1.1.6. Choosing a server</h4>
<div class="paragraph">
<p>Spring WebFlux is supported on Netty, Undertow, Tomcat, Jetty, and Servlet 3.1+ containers.
Each server is adapted to a common Reactive Streams API. The Spring WebFlux programming
models are built on that common API.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Common question: how can Tomcat and Jetty be used in both stacks?</strong><br>
Tomcat and Jetty are non-blocking at their core. It&#8217;s the Servlet API that adds a
blocking facade. Starting in version 3.1 the Servlet API adds a choice for non-blocking I/O.
However its use requires care to avoid other synchronous and blocking parts. For this
reason Spring&#8217;s reactive web stack has a low-level Servlet adapter to bridge to Reactive
Streams but the Servlet API is otherwise not exposed for direct use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spring Boot 2 uses Netty by default with WebFlux because Netty is more widely used in the
async, non-blocking space and also provides both client and server that can share resources.
By comparison Servlet 3.1 non-blocking I/O hasn&#8217;t seen much use because the bar to use it
is so high. Spring WebFlux opens one practical path to adoption.</p>
</div>
<div class="paragraph">
<p>The default server choice in Spring Boot is mainly about the out-of-the-box experience.
Applications can still choose any of the other supported servers which are also highly
optimized for performance, fully non-blocking, and adapted to Reactive Streams back
pressure. In Spring Boot it is trivial to make the switch.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-performance"><a class="anchor" href="#webflux-performance"></a>1.1.7. Performance vs scale</h4>
<div class="paragraph">
<p>Performance has many characteristics and meanings. Reactive and non-blocking generally
do not make applications run faster. They can, in some cases, for example if using the
<code>WebClient</code> to execute remote calls in parallel. On the whole it requires more work to do
things the non-blocking way and that can increase slightly the required processing time.</p>
</div>
<div class="paragraph">
<p>The key expected benefit of reactive and non-blocking is the ability to scale with a small,
fixed number of threads and less memory. That makes applications more resilient under load
because they scale in a more predictable way. In order to observe those benefits however you
need to have some latency including a mix of slow and unpredictable network I/O.
That&#8217;s where the reactive stack begins to show its strengths and the differences can be
dramatic.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="webflux-reactive-spring-web"><a class="anchor" href="#webflux-reactive-spring-web"></a>1.2. Reactive Spring Web</h3>
<div class="paragraph">
<p>The <code>spring-web</code> module provides low level infrastructure and HTTP abstractions&#8201;&#8212;&#8201;client
and server, to build reactive web applications. All public APIs are build around Reactive
Streams with Reactor as a backing implementation.</p>
</div>
<div class="paragraph">
<p>Server support is organized in two layers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#webflux-httphandler">HttpHandler</a> and server adapters&#8201;&#8212;&#8201;the most basic, common API
for HTTP request handling with Reactive Streams back pressure.</p>
</li>
<li>
<p><a href="#webflux-web-handler-api">WebHandler API</a>&#8201;&#8212;&#8201;slightly higher level but still general
purpose server web API with filter chain style processing.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="webflux-httphandler"><a class="anchor" href="#webflux-httphandler"></a>1.2.1. HttpHandler</h4>
<div class="paragraph">
<p>Every HTTP server has some API for HTTP request handling.
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/http/server/reactive/HttpHandler.html">HttpHandler</a>
is a simple contract with one method to handle a request and response.
It is intentionally minimal. Its main purpose is to provide a common, Reactive Streams
based API for HTTP request handling over different servers.</p>
</div>
<div class="paragraph">
<p>The <code>spring-web</code> module contains adapters for every supported server. The table below shows
the server APIs are used and where Reactive Streams support comes from:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Server name</th>
<th class="tableblock halign-left valign-top">Server API used</th>
<th class="tableblock halign-left valign-top">Reactive Streams support</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Netty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Netty API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/reactor/reactor-netty">Reactor Netty</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undertow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undertow API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-web: Undertow to Reactive Streams bridge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet 3.1 non-blocking I/O; Tomcat API to read and write ByteBuffers vs byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-web: Servlet 3.1 non-blocking I/O to Reactive Streams bridge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jetty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet 3.1 non-blocking I/O; Jetty API to write ByteBuffers vs byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-web: Servlet 3.1 non-blocking I/O to Reactive Streams bridge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet 3.1 container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet 3.1 non-blocking I/O</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-web: Servlet 3.1 non-blocking I/O to Reactive Streams bridge</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are required dependencies,
<a href="https://github.com/spring-projects/spring-framework/wiki/What%27s-New-in-the-Spring-Framework">supported versions</a>,
and code snippets for each server:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Server name</th>
<th class="tableblock halign-left valign-top">Group id</th>
<th class="tableblock halign-left valign-top">Artifact name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reactor Netty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.projectreactor.ipc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor-netty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undertow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.undertow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">undertow-core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.apache.tomcat.embed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tomcat-embed-core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jetty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.eclipse.jetty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jetty-server, jetty-servlet</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Reactor Netty:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpHandler handler = ...
ReactorHttpHandlerAdapter adapter = <span class="keyword">new</span> ReactorHttpHandlerAdapter(handler);
HttpServer.create(host, port).newHandler(adapter).block();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Undertow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpHandler handler = ...
UndertowHttpHandlerAdapter adapter = <span class="keyword">new</span> UndertowHttpHandlerAdapter(handler);
Undertow server = Undertow.builder().addHttpListener(port, host).setHandler(adapter).build();
server.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tomcat:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpHandler handler = ...
Servlet servlet = <span class="keyword">new</span> TomcatHttpHandlerAdapter(handler);

Tomcat server = <span class="keyword">new</span> Tomcat();
<span class="predefined-type">File</span> base = <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">java.io.tmpdir</span><span class="delimiter">&quot;</span></span>));
<span class="predefined-type">Context</span> rootContext = server.addContext(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, base.getAbsolutePath());
Tomcat.addServlet(rootContext, <span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>, servlet);
rootContext.addServletMappingDecoded(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>);
server.setHost(host);
server.setPort(port);
server.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jetty:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpHandler handler = ...
Servlet servlet = <span class="keyword">new</span> JettyHttpHandlerAdapter(handler);

Server server = <span class="keyword">new</span> Server();
ServletContextHandler contextHandler = <span class="keyword">new</span> ServletContextHandler(server, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
contextHandler.addServlet(<span class="keyword">new</span> ServletHolder(servlet), <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>);
contextHandler.start();

ServerConnector connector = <span class="keyword">new</span> ServerConnector(server);
connector.setHost(host);
connector.setPort(port);
server.addConnector(connector);
server.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also deploy as a WAR to any Servlet 3.1 container by wrapping the handler with
<code>ServletHttpHandlerAdapter</code> as a <code>Servlet</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-web-handler-api"><a class="anchor" href="#webflux-web-handler-api"></a>1.2.2. WebHandler API</h4>
<div class="paragraph">
<p><code>HttpHandler</code> is the basis for running on different servers. On that base the WebHandler
API provides a slightly higher level processing chain of
exception handlers
(<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/web/server/WebExceptionHandler.html">WebExceptionHandler</a>), filters
(<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/web/server/WebFilter.html">WebFilter</a>), and a target handler
(<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/web/server/WebHandler.html">WebHandler</a>).</p>
</div>
<div class="paragraph">
<p>All components work on <code>ServerWebExchange</code>&#8201;&#8212;&#8201;a container for the HTTP request and
response that also adds request attributes, session attributes, access to form data,
multipart data, and more.</p>
</div>
<div class="paragraph">
<p>The processing chain can be put together with <code>WebHttpHandlerBuilder</code> which builds an
<code>HttpHandler</code> that in turn can be run with a <a href="#webflux-httphandler">server adapter</a>.
To use the builder either add components individually or point to an <code>ApplicationContext</code>
to have the following detected:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bean name</th>
<th class="tableblock halign-left valign-top">Bean type</th>
<th class="tableblock halign-left valign-top">Count</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"webHandler"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target handler after filters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;any&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;any&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebExceptionHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception handlers after filter chain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"webSessionManager"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebSessionManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom session manager; <code>DefaultWebSessionManager</code> by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"serverCodecConfigurer"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServerCodecConfigurer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom form and multipart data decoders; <code>ServerCodecConfigurer.create()</code> by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"localeContextResolver"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocaleContextResolver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0..1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom resolver for <code>LocaleContext</code>; <code>AcceptHeaderLocaleContextResolver</code> by default</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="webflux-codecs"><a class="anchor" href="#webflux-codecs"></a>1.2.3. Codecs</h4>
<div class="paragraph">
<p>The <code>spring-web</code> module provides
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/http/codec/HttpMessageReader.html">HttpMessageReader</a> and
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/http/codec/HttpMessageWriter.html">HttpMessageWriter</a>
for encoding and decoding the HTTP request and response body with Reactive Streams.
It builds on lower level contracts from <code>spring-core</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/core/io/buffer/DataBuffer.html">DataBuffer</a>&#8201;&#8212;&#8201;abstraction for
byte buffers&#8201;&#8212;&#8201;e.g. Netty <code>ByteBuf</code>, <code>java.nio.ByteBuffer</code></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/core/codec/Encoder.html">Encoder</a>&#8201;&#8212;&#8201;serialize a stream of Objects
to a stream of data buffers</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/core/codec/Decoder.html">Decoder</a>&#8201;&#8212;&#8201;deserialize a stream of data
buffers into a stream of Objects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Basic <code>Encoder</code> and <code>Decoder</code> implementations exist in <code>spring-core</code> but <code>spring-web</code> adds
more for JSON, XML, and other formats. You can wrap any <code>Encoder</code> and <code>Decoder</code> as a reader
or writer with <code>EncoderHttpMessageWriter</code> and <code>DecoderHttpMessageReader</code>. There are some
additional, web-only reader and writer implementations for server-sent events, form data,
and more.</p>
</div>
<div class="paragraph">
<p>Finally, <code>ClientCodecConfigurer</code> and <code>ServerCodecConfigurer</code> can be used to initialize
a list of readers and writers. They include support for classpath detection and a
of defaults along with the ability to override or replace those defaults.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="webflux-dispatcher-handler"><a class="anchor" href="#webflux-dispatcher-handler"></a>1.3. The DispatcherHandler</h3>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-servlet">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>Spring WebFlux, like Spring MVC, is designed around the front controller pattern where a
central <code>WebHandler</code>, the <code>DispatcherHandler</code>, provides a shared algorithm for request
processing while actual work is performed by configurable, delegate components.
This model is flexible and supports diverse workflows.</p>
</div>
<div class="paragraph">
<p><code>DispatcherHandler</code> discovers the delegate components it needs from Spring configuration.
It is also designed to be a Spring bean itself and implements <code>ApplicationContextAware</code>
for access to the context it runs in. If <code>DispatcherHandler</code> is declared with the bean
name "webHandler" it is in turn discovered by
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/web/server/adapter/WebHttpHandlerBuilder.html">WebHttpHandlerBuilder</a>
which puts together a request processing chain as described in
<a href="#webflux-web-handler-api">WebHandler API</a>.</p>
</div>
<div class="paragraph">
<p>Spring configuration in a WebFlux application typically contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DispatcherHandler</code> with the bean name "webHandler"</p>
</li>
<li>
<p><code>WebFilter</code> and <code>WebExceptionHandler</code> beans</p>
</li>
<li>
<p><a href="#webflux-special-bean-types">DispatcherHandler special beans</a></p>
</li>
<li>
<p>Others</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The configuration is given to <code>WebHttpHandlerBuilder</code> to build the processing chain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext context = ...
HttpHandler handler = WebHttpHandlerBuilder.applicationContext(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting <code>HttpHandler</code> is ready for use with a
<a href="#webflux-httphandler">server adapter</a>.</p>
</div>
<div class="sect3">
<h4 id="webflux-special-bean-types"><a class="anchor" href="#webflux-special-bean-types"></a>1.3.1. Special bean types</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-servlet-special-bean-types">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>The <code>DispatcherHandler</code> delegates to special beans to process requests and render the
appropriate responses. By "special beans" we mean Spring-managed Object instances that
implement one of the framework contracts listed in the table below.
Spring WebFlux provides built-in implementations of these contracts but you can also
customize, extend, or replace them.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Special bean types in the ApplicationContext</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bean type</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HandlerMapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map a request to a handler. The mapping is based on some criteria the details of
  which vary by <code>HandlerMapping</code> implementation&#8201;&#8212;&#8201;annotated controllers, simple
  URL pattern mappings, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HandlerAdapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helps the <code>DispatcherHandler</code> to invoke a handler mapped to a request regardless of
  how the handler is actually invoked. For example invoking an annotated controller
  requires resolving various annotations. The main purpose of a <code>HandlerAdapter</code> is
  to shield the <code>DispatcherHandler</code> from such details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HandlerResultHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process the <code>HandlerResult</code> returned from a <code>HandlerAdapter</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="webflux-dispatcher-handler-sequence"><a class="anchor" href="#webflux-dispatcher-handler-sequence"></a>1.3.2. Processing sequence</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-servlet-sequence">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>The <code>DispatcherHandler</code> processes requests as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each <code>HandlerMapping</code> is asked to find a matching handler and the first match is used.</p>
</li>
<li>
<p>If a handler is found, it is executed through an appropriate <code>HandlerAdapter</code> which
exposes the return value from the execution as <code>HandlerResult</code>.</p>
</li>
<li>
<p>The <code>HandlerResult</code> is given to an appropriate <code>HandlerResultHandler</code> to complete
processing by writing to the response directly or using a view to render.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="webflux-controller"><a class="anchor" href="#webflux-controller"></a>1.4. Annotated Controllers</h3>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-controller">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>Spring WebFlux provides an annotation-based programming model where <code>@Controller</code> and
<code>@RestController</code> components use annotations to express request mappings, request input,
exception handling, and more. Annotated controllers have flexible method signatures and
do not have to extend base classes nor implement specific interfaces.</p>
</div>
<div class="paragraph">
<p>Here is a basic example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RestController</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloController</span> {

        <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">public</span> <span class="predefined-type">String</span> handle() {
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello WebFlux</span><span class="delimiter">&quot;</span></span>;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the methods returns a String to be written to the response body.</p>
</div>
<div class="sect3">
<h4 id="webflux-ann-controller"><a class="anchor" href="#webflux-ann-controller"></a>1.4.1. @Controller declaration</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-controller">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>You can define controller beans using a standard Spring bean definition.
The <code>@Controller</code> stereotype allows for auto-detection, aligned with Spring general support
for detecting <code>@Component</code> classes in the classpath and auto-registering bean definitions
for them. It also acts as a stereotype for the annotated class, indicating its role as
a web component.</p>
</div>
<div class="paragraph">
<p>To enable auto-detection of such <code>@Controller</code> beans, you can add component scanning to
your Java configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example.web</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> {

        <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@RestController</code> is a composed annotation that is itself annotated with <code>@Controller</code> and
<code>@ResponseBody</code> indicating a controller whose every method inherits the type-level
<code>@ResponseBody</code> annotation and therefore writes to the response body (vs model-and-vew
rendering).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="webflux-ann-requestmapping"><a class="anchor" href="#webflux-ann-requestmapping"></a>1.4.2. Mapping Requests</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-requestmapping">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>The <code>@RequestMapping</code> annotation is used to map requests to controllers methods. It has
various attributes to match by URL, HTTP method, request parameters, headers, and media
types. It can be used at the class-level to express shared mappings or at the method level
to narrow down to a specific endpoint mapping.</p>
</div>
<div class="paragraph">
<p>There are also HTTP method specific shortcut variants of <code>@RequestMapping</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@GetMapping</code></p>
</li>
<li>
<p><code>@PostMapping</code></p>
</li>
<li>
<p><code>@PutMapping</code></p>
</li>
<li>
<p><code>@DeleteMapping</code></p>
</li>
<li>
<p><code>@PatchMapping</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The shortcut variants are
<a href="https://github.com/spring-projects/spring-framework/wiki/Spring-Annotation-Programming-Model#composed-annotations">composed annotations</a>&#8201;&#8212;&#8201;themselves annotated with <code>@RequestMapping</code>. They are commonly used at the method level.
At the class level an <code>@RequestMapping</code> is more useful for expressing shared mappings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RestController</span>
<span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/persons</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">PersonController</span> {

        <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{id}</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">public</span> Person getPerson(<span class="annotation">@PathVariable</span> <span class="predefined-type">Long</span> id) {
                <span class="comment">// ...</span>
        }

        <span class="annotation">@PostMapping</span>
        <span class="annotation">@ResponseStatus</span>(HttpStatus.CREATED)
        <span class="directive">public</span> <span class="type">void</span> add(<span class="annotation">@RequestBody</span> Person person) {
                <span class="comment">// ...</span>
        }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="webflux-ann-requestmapping-uri-templates"><a class="anchor" href="#webflux-ann-requestmapping-uri-templates"></a>URI Patterns</h5>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-requestmapping-uri-templates">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>You can map requests using glob patterns and wildcards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>?</code> matches one character</p>
</li>
<li>
<p><code>*</code> matches zero or more characters within a path segment</p>
</li>
<li>
<p><code>**</code> match zero or more path segments</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also declare URI variables and access their values with <code>@PathVariable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/owners/{ownerId}/pets/{petId}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Pet findPet(<span class="annotation">@PathVariable</span> <span class="predefined-type">Long</span> ownerId, <span class="annotation">@PathVariable</span> <span class="predefined-type">Long</span> petId) {
        <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>URI variables can be declared at the class and method level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/owners/{ownerId}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OwnerController</span> {

        <span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/pets/{petId}</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">public</span> Pet findPet(<span class="annotation">@PathVariable</span> <span class="predefined-type">Long</span> ownerId, <span class="annotation">@PathVariable</span> <span class="predefined-type">Long</span> petId) {
                <span class="comment">// ...</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>URI variables are automatically converted to the appropriate type or`TypeMismatchException`
is raised. Simple types&#8201;&#8212;&#8201;<code>int</code>, <code>long</code>, <code>Date</code>, are supported by default and you can
register support for any other data type.</p>
</div>
<div class="paragraph">
<p>URI variables can be named explicitly&#8201;&#8212;&#8201;e.g. <code>@PathVariable("customId")</code>, but you can
leave that detail out if the names are the same and your code is compiled with debugging
information or with the <code>-parameters</code> compiler flag on Java 8.</p>
</div>
<div class="paragraph">
<p>The syntax <code>{*varName}</code> declares a URI variable that matches zero or more remaining
path segments. For example <code>/resources/{*path}</code> matches all files <code>/resources/</code> and the
<code>"path"</code> variable captures the complete relative path.</p>
</div>
<div class="paragraph">
<p>The syntax <code>{varName:regex}</code> declares a URI variable with a regular expressions with the
syntax <code>{varName:regex}</code>&#8201;&#8212;&#8201;e.g. given URL <code>"/spring-web-3.0.5 .jar"</code>, the below method
extracts the name, version, and file extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{name:[a-z-]+}-{version:</span><span class="char">\\</span><span class="content">d</span><span class="char">\\</span><span class="content">.</span><span class="char">\\</span><span class="content">d</span><span class="char">\\</span><span class="content">.</span><span class="char">\\</span><span class="content">d}{ext:</span><span class="char">\\</span><span class="content">.[a-z]+}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> handle(<span class="annotation">@PathVariable</span> <span class="predefined-type">String</span> version, <span class="annotation">@PathVariable</span> <span class="predefined-type">String</span> ext) {
        <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>URI path patterns can also have embedded <code>${&#8230;&#8203;}</code> placeholders that are resolved on startup
 via <code>PropertyPlaceHolderConfigurer</code> against local, system, environment, and other property
sources. This can be used for example to parameterize a base URL based on some external
configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Spring WebFlux uses <code>PathPattern</code> and the <code>PathPatternParser</code> for URI path matching support
both of which are located in <code>spring-web</code> and expressly designed for use with HTTP URL
paths in web applications where a large number of URI path patterns are matched at runtime.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spring WebFlux does not support suffix pattern matching&#8201;&#8212;&#8201;unlike Spring MVC, where a
mapping such as <code>/person</code> also matches to <code>/person.*</code>. For URL based content
negotiation, if needed, we recommend using a query parameter, which is more simpler, more
explicit, and less vulnerable to URL path based exploits.</p>
</div>
</div>
<div class="sect4">
<h5 id="webflux-ann-requestmapping-pattern-comparison"><a class="anchor" href="#webflux-ann-requestmapping-pattern-comparison"></a>Pattern Comparison</h5>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-requestmapping-pattern-comparison">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>When multiple patterns match a URL, they must be compared to find the best match. This is done
with <code>PathPattern.SPECIFICITY_COMPARATOR</code> which looks for patterns that more specific.</p>
</div>
<div class="paragraph">
<p>For every pattern, a score is computed based the number of URI variables and wildcards
where a URI variable scores lower than a wildcard. A pattern with a lower total score
wins. If two patterns have the same score, then the longer is chosen.</p>
</div>
<div class="paragraph">
<p>Catch-all patterns, e.g. <code>**</code>, <code>{*varName}</code>, are excluded from the scoring and are always
sorted last instead. If two patterns are both catch-all, the longer is chosen.</p>
</div>
</div>
<div class="sect4">
<h5 id="webflux-ann-requestmapping-consumes"><a class="anchor" href="#webflux-ann-requestmapping-consumes"></a>Consumable Media Types</h5>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-requestmapping-consumes">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>You can narrow the request mapping based on the <code>Content-Type</code> of the request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PostMapping</span>(path = <span class="string"><span class="delimiter">&quot;</span><span class="content">/pets</span><span class="delimiter">&quot;</span></span>, <strong>consumes = <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="type">void</span> addPet(<span class="annotation">@RequestBody</span> Pet pet) {
        <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The consumes attribute also supports negation expressions&#8201;&#8212;&#8201;e.g. <code>!text/plain</code> means any
content type other than "text/plain".</p>
</div>
<div class="paragraph">
<p>You can declare a shared consumes attribute at the class level. Unlike most other request
mapping attributes however when used at the class level, a method-level consumes attribute
will overrides rather than extend the class level declaration.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>MediaType</code> provides constants for commonly used media types&#8201;&#8212;&#8201;e.g.
<code>APPLICATION_JSON_VALUE</code>, <code>APPLICATION_JSON_UTF8_VALUE</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="webflux-ann-requestmapping-produces"><a class="anchor" href="#webflux-ann-requestmapping-produces"></a>Producible Media Types</h5>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-requestmapping-produces">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>You can narrow the request mapping based on the <code>Accept</code> request header and the list of
content types that a controller method produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(path = <span class="string"><span class="delimiter">&quot;</span><span class="content">/pets/{petId}</span><span class="delimiter">&quot;</span></span>, <strong>produces = <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json;charset=UTF-8</span><span class="delimiter">&quot;</span></span></strong>)
<span class="annotation">@ResponseBody</span>
<span class="directive">public</span> Pet getPet(<span class="annotation">@PathVariable</span> <span class="predefined-type">String</span> petId) {
        <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The media type can specify a character set. Negated expressions are supported&#8201;&#8212;&#8201;e.g.
<code>!text/plain</code> means any content type other than "text/plain".</p>
</div>
<div class="paragraph">
<p>You can declare a shared produces attribute at the class level. Unlike most other request
mapping attributes however when used at the class level, a method-level produces attribute
will overrides rather than extend the class level declaration.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>MediaType</code> provides constants for commonly used media types&#8201;&#8212;&#8201;e.g.
<code>APPLICATION_JSON_VALUE</code>, <code>APPLICATION_JSON_UTF8_VALUE</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="webflux-ann-requestmapping-params-and-headers"><a class="anchor" href="#webflux-ann-requestmapping-params-and-headers"></a>Parameters and Headers</h5>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-requestmapping-params-and-headers">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>You can narrow request mappings based on query parameter conditions. You can test for the
presence of a query parameter (<code>"myParam"</code>), for the absence (<code>"!myParam"</code>), or for a
specific value (<code>"myParam=myValue"</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(path = <span class="string"><span class="delimiter">&quot;</span><span class="content">/pets/{petId}</span><span class="delimiter">&quot;</span></span>, <strong>params = <span class="string"><span class="delimiter">&quot;</span><span class="content">myParam=myValue</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="type">void</span> findPet(<span class="annotation">@PathVariable</span> <span class="predefined-type">String</span> petId) {
        <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the same with request header conditions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GetMapping</span>(path = <span class="string"><span class="delimiter">&quot;</span><span class="content">/pets</span><span class="delimiter">&quot;</span></span>, <strong>headers = <span class="string"><span class="delimiter">&quot;</span><span class="content">myHeader=myValue</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="type">void</span> findPet(<span class="annotation">@PathVariable</span> <span class="predefined-type">String</span> petId) {
        <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="webflux-ann-requestmapping-head-options"><a class="anchor" href="#webflux-ann-requestmapping-head-options"></a>HTTP HEAD, OPTIONS</h5>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-requestmapping-head-options">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p><code>@GetMapping</code>&#8201;&#8212;&#8201;and also <code>@RequestMapping(method=HttpMethod.GET)</code>, support HTTP HEAD
transparently for request mapping purposes. Controller methods don&#8217;t need to change.
A response wrapper, applied in the <code>HttpHandler</code> server adapter, ensures a <code>"Content-Length"</code>
header is set to the number of bytes written and without actually writing to the response.</p>
</div>
<div class="paragraph">
<p>By default HTTP OPTIONS is handled by setting the "Allow" response header to the list of HTTP
methods listed in all <code>@RequestMapping</code> methods with matching URL patterns.</p>
</div>
<div class="paragraph">
<p>For a <code>@RequestMapping</code> without HTTP method declarations, the "Allow" header is set to
<code>"GET,HEAD,POST,PUT,PATCH,DELETE,OPTIONS"</code>. Controller methods should always declare the
supported HTTP methods for example by using the HTTP method specific variants&#8201;&#8212;&#8201;<code>@GetMapping</code>, <code>@PostMapping</code>, etc.</p>
</div>
<div class="paragraph">
<p><code>@RequestMapping</code> method can be explicitly mapped to HTTP HEAD and HTTP OPTIONS, but that
is not necessary in the common case.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webflux-ann-methods"><a class="anchor" href="#webflux-ann-methods"></a>1.4.3. Handler methods</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-methods">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p><code>@RequestMapping</code> handler methods have a flexible signature and can choose from a range of
supported controller method arguments and return values.</p>
</div>
<div class="sect4">
<h5 id="webflux-ann-arguments"><a class="anchor" href="#webflux-ann-arguments"></a>Method arguments</h5>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-arguments">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>The table below shows supported controller method arguments.</p>
</div>
<div class="paragraph">
<p>Reactive types (Reactor, RxJava, <a href="#webflux-reactive-libraries">or other</a>) are
supported on arguments that require blocking I/O, e.g. reading the request body, to
be resolved. This is marked in the description column. Reactive types are not expected
on arguments that don&#8217;t require blocking.</p>
</div>
<div class="paragraph">
<p>JDK 1.8&#8217;s <code>java.util.Optional</code> is supported as a method argument in combination with
annotations that have a <code>required</code> attribute&#8201;&#8212;&#8201;e.g. <code>@RequestParam</code>, <code>@RequestHeader</code>,
etc, and is equivalent to <code>required=false</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Controller method argument</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServerWebExchange</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to the full <code>ServerWebExchange</code>&#8201;&#8212;&#8201;container for the HTTP request and response,
request and session attributes, <code>checkNotModified</code> methods, and others.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServerHttpRequest</code>, <code>ServerHttpResponse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to the HTTP request or response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WebSession</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to the session; this does not forcing the start of a new session unless attributes
are added. Supports reactive types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.security.Principal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currently authenticated user; possibly a specific <code>Principal</code> implementation class if known.
Supports reactive types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.springframework.http.HttpMethod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The HTTP method of the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Locale</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current request locale, determined by the most specific <code>LocaleResolver</code> available, in
 effect, the configured <code>LocaleResolver</code>/<code>LocaleContextResolver</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java 6+: <code>java.util.TimeZone</code><br>
Java 8+: <code>java.time.ZoneId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time zone associated with the current request, as determined by a <code>LocaleContextResolver</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PathVariable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For access to URI template variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For access to Servlet request parameters. Parameter values are converted to the declared
method argument type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For access to request headers. Header values are converted to the declared method argument
type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestBody</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For access to the HTTP request body. Body content is converted to the declared method
argument type using <code>HttpMessageReader</code>'s. Supports reactive types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpEntity&lt;B&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For access to request headers and body. The body is converted with <code>HttpMessageReader</code>'s.
Supports reactive types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestPart</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For access to a part in  a "multipart/form-data" request. Supports reactive types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Map</code>, <code>org.springframework.ui.Model</code>, <code>org.springframework.ui.ModelMap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For access and updates of the implicit model that is exposed to the web view.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command or form object (with optional <code>@ModelAttribute</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command object whose properties to bind to request parameters&#8201;&#8212;&#8201;via setters or directly to
fields, with customizable type conversion, depending on <code>@InitBinder</code> methods and/or the
HandlerAdapter configuration (see the <code>webBindingInitializer</code> property on
<code>RequestMappingHandlerAdapter</code>).</p>
<p class="tableblock">Command objects along with their validation results are exposed as model attributes, by
default using the command class name - e.g. model attribute "orderAddress" for a command
object of type "some.package.OrderAddress". <code>@ModelAttribute</code> can be used to customize the
model attribute name.</p>
<p class="tableblock">Supports reactive types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Errors</code>, <code>BindingResult</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation results for the command/form object data binding; this argument must be
declared immediately after the command/form object in the controller method signature.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SessionStatus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For marking form processing complete which triggers cleanup of session attributes
declared through a class-level <code>@SessionAttributes</code> annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UriComponentsBuilder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For preparing a URL relative to the current request&#8217;s host, port, scheme, context path, and
the literal  part of the servlet mapping also taking into account <code>Forwarded</code> and
<code>X-Forwarded-*</code> headers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@SessionAttribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For access to any session attribute; in contrast to model attributes stored in the session
as a result of a class-level <code>@SessionAttributes</code> declaration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestAttribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For access to request attributes.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="webflux-ann-return-types"><a class="anchor" href="#webflux-ann-return-types"></a>Return values</h5>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-ann-return-types">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>The table below shows supported controller method return values. Reactive types&#8201;&#8212;&#8201;Reactor, RxJava, <a href="#webflux-reactive-libraries">or other</a> are supported for all return
values.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Controller method return value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ResponseBody</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The return value is encoded through <code>HttpMessageWriter</code>s and written to the response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpEntity&lt;B&gt;</code>, <code>ResponseEntity&lt;B&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The return value specifies the full response including HTTP headers and body be encoded
through <code>HttpMessageWriter</code>s and written to the response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpHeaders</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For returning a response with headers and no body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A view name to be resolved with <code>ViewResolver</code>'s and used together with the implicit
model&#8201;&#8212;&#8201;determined through command objects and <code>@ModelAttribute</code> methods. The handler
method may also programmatically enrich the model by declaring a <code>Model</code> argument (see
above).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>View</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>View</code> instance to use for rendering together with the implicit model&#8201;&#8212;&#8201;determined
through command objects and <code>@ModelAttribute</code> methods. The handler method may also
programmatically enrich the model by declaring a <code>Model</code> argument (see above).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Map</code>, <code>org.springframework.ui.Model</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attributes to be added to the implicit model with the view name implicitly determined
from the request path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Rendering</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An API for model and view rendering scenarios.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For use in method that don&#8217;t write the response body; or methods where the view name is
supposed to be determined implicitly from the request path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;ServerSentEvent&gt;</code>, <code>Observable&lt;ServerSentEvent&gt;</code>, or other reactive type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emit server-sent events; the <code>SeverSentEvent</code> wrapper can be omitted when only data needs
to be written (however <code>text/event-stream</code> must be requested or declared in the mapping
through the produces attribute).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any other return type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A single model attribute to be added to the implicit model with the view name implicitly
determined through a <code>RequestToViewNameTranslator</code>; the attribute name may be specified
through a method-level <code>@ModelAttribute</code> or otherwise a name is selected based on the
class name of the return type.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="webflux-fn"><a class="anchor" href="#webflux-fn"></a>1.5. Functional Endpoints</h3>
<div class="paragraph">
<p>Spring WebFlux provides a lightweight, functional programming model where functions
are used to route and handle requests and where contracts are designed for immutability.
It is an alternative to the annotated-based programming model but runs on the same
<a href="#webflux-reactive-spring-web">Reactive Spring Web</a> foundation</p>
</div>
<div class="sect3">
<h4 id="webflux-fn-handler-functions"><a class="anchor" href="#webflux-fn-handler-functions"></a>1.5.1. HandlerFunction</h4>
<div class="paragraph">
<p>Incoming HTTP requests are handled by a <strong><code>HandlerFunction</code></strong>, which is essentially a function that
takes a <code>ServerRequest</code> and returns a <code>Mono&lt;ServerResponse&gt;</code>. The annotation counterpart to a
handler function is an <code>@RequestMapping</code> method.</p>
</div>
<div class="paragraph">
<p><code>ServerRequest</code> and <code>ServerResponse</code> are immutable interfaces that offer JDK-8 friendly access
to the underlying HTTP messages with <a href="http://www.reactive-streams.org">Reactive Streams</a>
non-blocking back pressure. The request exposes the body as Reactor <code>Flux</code> or <code>Mono</code>
types; the response accepts any Reactive Streams <code>Publisher</code> as body (see
<a href="#webflux-reactive-libraries">Reactive Libraries</a>).</p>
</div>
<div class="paragraph">
<p><code>ServerRequest</code> gives access to various HTTP request elements:
the method, URI, query parameters, and&#8201;&#8212;&#8201;through the separate <code>ServerRequest.Headers</code> interface&#8201;&#8212;&#8201;the headers. Access to the body is provided through the <code>body</code> methods. For instance, this is
how to extract the request body into a <code>Mono&lt;String&gt;</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Mono&lt;String&gt; string = request.bodyToMono(String.class);</pre>
</div>
</div>
<div class="paragraph">
<p>And here is how to extract the body into a <code>Flux</code>, where <code>Person</code> is a class that can be
deserialised from the contents of the body (i.e. <code>Person</code> is supported by Jackson if the body
contains JSON, or JAXB if XML).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Flux&lt;Person&gt; people = request.bodyToFlux(Person.class);</pre>
</div>
</div>
<div class="paragraph">
<p>The above&#8201;&#8212;&#8201;<code>bodyToMono</code> and <code>bodyToFlux</code>, are, in fact, convenience methods that use the
generic <code>ServerRequest.body(BodyExtractor)</code> method. <code>BodyExtractor</code> is
a functional strategy interface that allows you to write your own extraction logic, but common
<code>BodyExtractor</code> instances can be found in the <code>BodyExtractors</code> utility class. So, the above
examples can be replaced with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Mono&lt;String&gt; string = request.body(BodyExtractors.toMono(String.class);
Flux&lt;Person&gt; people = request.body(BodyExtractors.toFlux(Person.class);</pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, <code>ServerResponse</code> provides access to the HTTP response. Since it is immutable, you create
a <code>ServerResponse</code> with a builder. The builder allows you to set the response status, add response
headers, and provide a body. For instance, this is how to create a response with a 200 OK status,
a JSON content-type, and a body:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Mono&lt;Person&gt; person = ...
ServerResponse.ok().contentType(MediaType.APPLICATION_JSON).body(person);</pre>
</div>
</div>
<div class="paragraph">
<p>And here is how to build a response with a 201 CREATED status, a <code>"Location"</code> header, and
empty body:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>URI location = ...
ServerResponse.created(location).build();</pre>
</div>
</div>
<div class="paragraph">
<p>Putting these together allows us to create a <code>HandlerFunction</code>. For instance, here is an example
of a simple "Hello World" handler lambda, that returns a response with a 200 status and a body
based on a String:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HandlerFunction&lt;ServerResponse&gt; helloWorld =
  request -&gt; ServerResponse.ok().body(fromObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Writing handler functions as lambda&#8217;s, as we do above, is convenient, but perhaps lacks in
readability and becomes less maintainable when dealing with multiple functions. Therefore, it is
recommended to group related handler functions into a handler or controller class. For example,
here is a class that exposes a reactive <code>Person</code> repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.MediaType.APPLICATION_JSON</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.web.reactive.function.BodyInserters.fromObject</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">PersonHandler</span> {

        <span class="directive">private</span> <span class="directive">final</span> PersonRepository repository;

        <span class="directive">public</span> PersonHandler(PersonRepository repository) {
                <span class="local-variable">this</span>.repository = repository;
        }

        <span class="directive">public</span> Mono&lt;ServerResponse&gt; listPeople(ServerRequest request) { <i class="conum" data-value="1"></i><b>(1)</b>
                Flux&lt;Person&gt; people = repository.allPeople();
                <span class="keyword">return</span> ServerResponse.ok().contentType(APPLICATION_JSON).body(people, Person.class);
        }

        <span class="directive">public</span> Mono&lt;ServerResponse&gt; createPerson(ServerRequest request) { <i class="conum" data-value="2"></i><b>(2)</b>
                Mono&lt;Person&gt; person = request.bodyToMono(Person.class);
                <span class="keyword">return</span> ServerResponse.ok().build(repository.savePerson(person));
        }

        <span class="directive">public</span> Mono&lt;ServerResponse&gt; getPerson(ServerRequest request) { <i class="conum" data-value="3"></i><b>(3)</b>
                <span class="type">int</span> personId = <span class="predefined-type">Integer</span>.valueOf(request.pathVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>));
                Mono&lt;ServerResponse&gt; notFound = ServerResponse.notFound().build();
                Mono&lt;Person&gt; personMono = <span class="local-variable">this</span>.repository.getPerson(personId);
                <span class="keyword">return</span> personMono
                                .flatMap(person -&gt; ServerResponse.ok().contentType(APPLICATION_JSON).body(fromObject(person)))
                                .switchIfEmpty(notFound);
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>listPeople</code> is a handler function that returns all <code>Person</code> objects found in the repository as
JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>createPerson</code> is a handler function that stores a new <code>Person</code> contained in the request body.
Note that <code>PersonRepository.savePerson(Person)</code> returns <code>Mono&lt;Void&gt;</code>: an empty Mono that emits
a completion signal when the person has been read from the request and stored. So we use the
<code>build(Publisher&lt;Void&gt;)</code> method to send a response when that completion signal is received, i.e.
when the <code>Person</code> has been saved.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>getPerson</code> is a handler function that returns a single person, identified via the path
variable <code>id</code>. We retrieve that <code>Person</code> via the repository, and create a JSON response if it is
found. If it is not found, we use <code>switchIfEmpty(Mono&lt;T&gt;)</code> to return a 404 Not Found response.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="webflux-fn-router-functions"><a class="anchor" href="#webflux-fn-router-functions"></a>1.5.2. RouterFunction</h4>
<div class="paragraph">
<p>Incoming requests are routed to handler functions with a <strong><code>RouterFunction</code></strong>, which is a function
that takes a <code>ServerRequest</code>, and returns a <code>Mono&lt;HandlerFunction&gt;</code>. If a request matches a
particular route, a handler function is returned; otherwise it returns an empty <code>Mono</code>. The
<code>RouterFunction</code> has a similar purpose as the <code>@RequestMapping</code> annotation in <code>@Controller</code> classes.</p>
</div>
<div class="paragraph">
<p>Typically, you do not write router functions yourself, but rather use
<code>RouterFunctions.route(RequestPredicate, HandlerFunction)</code> to
create one using a request predicate and handler function. If the predicate applies, the request is
routed to the given handler function; otherwise no routing is performed, resulting in a
404 Not Found response.
Though you can write your own <code>RequestPredicate</code>, you do not have to: the <code>RequestPredicates</code>
utility class offers commonly used predicates, such matching based on path, HTTP method,
content-type, etc.
Using <code>route</code>, we can route to our "Hello World" handler function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RouterFunction&lt;ServerResponse&gt; helloWorldRoute =
        RouterFunctions.route(RequestPredicates.path(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello-world</span><span class="delimiter">&quot;</span></span>),
        request -&gt; Response.ok().body(fromObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two router functions can be composed into a new router function that routes to either handler
function: if the predicate of the first route does not match, the second is evaluated.
Composed router functions are evaluated in order, so it makes sense to put specific functions
before generic ones.
You can compose two router functions by calling <code>RouterFunction.and(RouterFunction)</code>, or by calling
<code>RouterFunction.andRoute(RequestPredicate, HandlerFunction)</code>, which is a convenient combination
of <code>RouterFunction.and()</code> with <code>RouterFunctions.route()</code>.</p>
</div>
<div class="paragraph">
<p>Given the <code>PersonHandler</code> we showed above, we can now define a router function that routes to the
respective handler functions.
We use <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html">method-references</a>
to refer to the handler functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.MediaType.APPLICATION_JSON</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.web.reactive.function.server.RequestPredicates</span>.*;

PersonRepository repository = ...
PersonHandler handler = <span class="keyword">new</span> PersonHandler(repository);

RouterFunction&lt;ServerResponse&gt; personRoute =
        route(GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/person/{id}</span><span class="delimiter">&quot;</span></span>).and(accept(APPLICATION_JSON)), handler::getPerson)
                .andRoute(GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/person</span><span class="delimiter">&quot;</span></span>).and(accept(APPLICATION_JSON)), handler::listPeople)
                .andRoute(POST(<span class="string"><span class="delimiter">&quot;</span><span class="content">/person</span><span class="delimiter">&quot;</span></span>).and(contentType(APPLICATION_JSON)), handler::createPerson);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides router functions, you can also compose request predicates, by calling
<code>RequestPredicate.and(RequestPredicate)</code> or <code>RequestPredicate.or(RequestPredicate)</code>.
These work as expected: for <code>and</code> the resulting predicate matches if <strong>both</strong> given predicates match;
<code>or</code> matches if <strong>either</strong> predicate does.
Most of the predicates found in <code>RequestPredicates</code> are compositions.
For instance, <code>RequestPredicates.GET(String)</code> is a composition of
<code>RequestPredicates.method(HttpMethod)</code> and <code>RequestPredicates.path(String)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-fn-running"><a class="anchor" href="#webflux-fn-running"></a>1.5.3. Running a server</h4>
<div class="paragraph">
<p>How do you run a router function in an HTTP server? A simple option is to convert a
router function to an <code>HttpHandler</code> via <code>RouterFunctions.toHttpHandler(RouterFunction)</code>.
The <code>HttpHandler</code> can then be used with a number of servers adapters.
See <a href="#webflux-httphandler">HttpHandler</a> for server-specific
instructions.</p>
</div>
<div class="paragraph">
<p>it is also possible to run with a
<a href="#webflux-dispatcher-handler">DispatcherHandler</a> setup&#8201;&#8212;&#8201;side by side
with annotated controllers. The easiest way to do that is through the
<a href="#webflux-config">WebFlux Java Config</a> which creates the necessary configuration to
handle requests with router and handler functions.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-fn-handler-filter-function"><a class="anchor" href="#webflux-fn-handler-filter-function"></a>1.5.4. HandlerFilterFunction</h4>
<div class="paragraph">
<p>Routes mapped by a router function can be filtered by calling
<code>RouterFunction.filter(HandlerFilterFunction)</code>, where <code>HandlerFilterFunction</code> is essentially a
function that takes a <code>ServerRequest</code> and <code>HandlerFunction</code>, and returns a <code>ServerResponse</code>.
The handler function parameter represents the next element in the chain: this is typically the
<code>HandlerFunction</code> that is routed to, but can also be another <code>FilterFunction</code> if multiple filters
are applied.
With annotations, similar functionality can be achieved using <code>@ControllerAdvice</code> and/or a <code>ServletFilter</code>.
Let&#8217;s add a simple security filter to our route, assuming that we have a <code>SecurityManager</code> that
can determine whether a particular path is allowed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.UNAUTHORIZED</span>;

<span class="predefined-type">SecurityManager</span> securityManager = ...
RouterFunction&lt;ServerResponse&gt; route = ...

RouterFunction&lt;ServerResponse&gt; filteredRoute =
        route.filter(request, next) -&gt; {
                <span class="keyword">if</span> (securityManager.allowAccessTo(request.path())) {
                        <span class="keyword">return</span> next.handle(request);
                }
                <span class="keyword">else</span> {
                        <span class="keyword">return</span> ServerResponse.status(UNAUTHORIZED).build();
                }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see in this example that invoking the <code>next.handle(ServerRequest)</code> is optional: we only
allow the handler function to be executed when access is allowed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="webflux-config"><a class="anchor" href="#webflux-config"></a>1.6. WebFlux Java Config</h3>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>The WebFlux Java config provides default configuration suitable for most applications along
with a configuration API to customize it. For more advanced customizations, not available in
the configuration API, see <a href="#webflux-config-advanced-java">Advanced config mode</a>.</p>
</div>
<div class="paragraph">
<p>You do not need to understand the underlying beans created by the Java config, but it&#8217;s
easy to seem them in <code>WebFluxConfigurationSupport</code>, and if you want to learn more, see
<a href="#webflux-special-bean-types">Special bean types</a>.</p>
</div>
<div class="sect3">
<h4 id="webflux-config-enable"><a class="anchor" href="#webflux-config-enable"></a>1.6.1. Enable the configuration</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-enable">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>Use the <code>@EnableWebFlux</code> annotation in your Java config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above registers a number of Spring WebFlux
<a href="#mvc-webflux-special-bean-types">infrastructure beans</a> also adapting to dependencies
available on the classpath&#8201;&#8212;&#8201;for JSON, XML, etc.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-config-customize"><a class="anchor" href="#webflux-config-customize"></a>1.6.2. Configuration API</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-customize">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>In your Java config implement the <code>WebFluxConfigurer</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="comment">// Implement configuration methods...</span>

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webflux-config-conversion"><a class="anchor" href="#webflux-config-conversion"></a>1.6.3. Conversion, formatting</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-conversion">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>By default formatters for <code>Number</code> and <code>Date</code> types are installed, including support for
the <code>@NumberFormat</code> and <code>@DateTimeFormat</code> annotations. Full support for the Joda Time
formatting library is also installed if Joda Time is present on the classpath.</p>
</div>
<div class="paragraph">
<p>To register custom formatters and converters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> addFormatters(FormatterRegistry registry) {
                <span class="comment">// ...</span>
        }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See <a href="core.html#format-FormatterRegistrar-SPI">FormatterRegistrar SPI</a>
and the <code>FormattingConversionServiceFactoryBean</code> for more information on when to use FormatterRegistrars.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="webflux-config-validation"><a class="anchor" href="#webflux-config-validation"></a>1.6.4. Validation</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-validation">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>By default if <a href="core.html#validation-beanvalidation-overview">Bean Validation</a> is present
on the classpath&#8201;&#8212;&#8201;e.g. Hibernate Validator, the <code>LocalValidatorFactoryBean</code> is registered
as a global <a href="core.html#validator">Validator</a> for use with <code>@Valid</code> and <code>Validated</code> on
<code>@Controller</code> method arguments.</p>
</div>
<div class="paragraph">
<p>In your Java config, you can customize the global <code>Validator</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Validator</span> getValidator(); {
                <span class="comment">// ...</span>
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also register <code>Validator</code>'s locally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyController</span> {

        <span class="annotation">@InitBinder</span>
        <span class="directive">protected</span> <span class="type">void</span> initBinder(WebDataBinder binder) {
                binder.addValidators(<span class="keyword">new</span> FooValidator());
        }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you need to have a <code>LocalValidatorFactoryBean</code> injected somewhere, create a bean and
mark it with <code>@Primary</code> in order to avoid conflict with the one declared in the MVC config.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="webflux-config-content-negotiation"><a class="anchor" href="#webflux-config-content-negotiation"></a>1.6.5. Content type resolvers</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-content-negotiation">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>You can configure how Spring WebFlux determines the requested media types for
<code>@Controller</code>'s from the request. By default only the "Accept" header is checked but you
can also enable a query parameter based strategy.</p>
</div>
<div class="paragraph">
<p>To customize the requested content type resolution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> configureContentTypeResolver(RequestedContentTypeResolverBuilder builder) {
                <span class="comment">// ...</span>
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webflux-config-message-codecs"><a class="anchor" href="#webflux-config-message-codecs"></a>1.6.6. HTTP message codecs</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-message-converters">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>To customize how the request and response body are read and written:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> configureHttpMessageCodecs(ServerCodecConfigurer configurer) {
                <span class="comment">// ...</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ServerCodecConfigurer</code> provides a set of default readers and writers. You can use it to add
more readers and writers, customize the default ones, or replace the default ones completely.</p>
</div>
<div class="paragraph">
<p>For Jackson JSON and XML, consider using the
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/http/converter/json/Jackson2ObjectMapperBuilder.html">Jackson2ObjectMapperBuilder</a>
which customizes Jackson&#8217;s default properties with the following ones:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.6/com/fasterxml/jackson/databind/DeserializationFeature.html#FAIL_ON_UNKNOWN_PROPERTIES"><code>DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES</code></a> is disabled.</p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.6/com/fasterxml/jackson/databind/MapperFeature.html#DEFAULT_VIEW_INCLUSION"><code>MapperFeature.DEFAULT_VIEW_INCLUSION</code></a> is disabled.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It also automatically registers the following well-known modules if they are detected on the classpath:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://github.com/FasterXML/jackson-datatype-jdk7">jackson-datatype-jdk7</a>: support for Java 7 types like <code>java.nio.file.Path</code>.</p>
</li>
<li>
<p><a href="https://github.com/FasterXML/jackson-datatype-joda">jackson-datatype-joda</a>: support for Joda-Time types.</p>
</li>
<li>
<p><a href="https://github.com/FasterXML/jackson-datatype-jsr310">jackson-datatype-jsr310</a>: support for Java 8 Date &amp; Time API types.</p>
</li>
<li>
<p><a href="https://github.com/FasterXML/jackson-datatype-jdk8">jackson-datatype-jdk8</a>: support for other Java 8 types like <code>Optional</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="webflux-config-view-resolvers"><a class="anchor" href="#webflux-config-view-resolvers"></a>1.6.7. View resolvers</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-view-resolvers">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>To configure view resolution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> configureViewResolvers(ViewResolverRegistry registry) {
                <span class="comment">// ...</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that FreeMarker also requires configuration of the underlying view technology:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="comment">// ...</span>

        <span class="annotation">@Bean</span>
        <span class="directive">public</span> FreeMarkerConfigurer freeMarkerConfigurer() {
                FreeMarkerConfigurer configurer = <span class="keyword">new</span> FreeMarkerConfigurer();
                configurer.setTemplateLoaderPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/templates</span><span class="delimiter">&quot;</span></span>);
                <span class="keyword">return</span> configurer;
        }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webflux-config-static-resources"><a class="anchor" href="#webflux-config-static-resources"></a>1.6.8. Static resources</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-static-resources">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>This option provides a convenient way to serve static resources from a list of
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/core/io/Resource.html">Resource</a>-based locations.</p>
</div>
<div class="paragraph">
<p>In the example below, given a request that starts with <code>"/resources"</code>, the relative path is
used to find and serve static resources relative to <code>"/static"</code> on the classpath. Resources
will be served with a 1-year future expiration to ensure maximum use of the browser cache
and a reduction in HTTP requests made by the browser. The <code>Last-Modified</code> header is also
evaluated and if present a <code>304</code> status code is returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
                registry.addResourceHandler(<span class="string"><span class="delimiter">&quot;</span><span class="content">/resources/**</span><span class="delimiter">&quot;</span></span>)
                        .addResourceLocations(<span class="string"><span class="delimiter">&quot;</span><span class="content">/public</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/static/</span><span class="delimiter">&quot;</span></span>)
                        .setCachePeriod(<span class="integer">31556926</span>);
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resource handler also supports a chain of
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/web/reactive/resource/ResourceResolver.html">ResourceResolver</a>'s and
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/web/reactive/resource/ResourceTransformer.html">ResourceResolver</a>'s.
which can be used to create a toolchain for working with optimized resources.</p>
</div>
<div class="paragraph">
<p>The <code>VersionResourceResolver</code> can be used for versioned resource URLs based on an MD5 hash
computed from the content, a fixed application version, or other. A
<code>ContentVersionStrategy</code> (MD5 hash) is a good choice with some notable exceptions such as
JavaScript resources used with a module loader.</p>
</div>
<div class="paragraph">
<p>For example in your Java config;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
                registry.addResourceHandler(<span class="string"><span class="delimiter">&quot;</span><span class="content">/resources/**</span><span class="delimiter">&quot;</span></span>)
                                .addResourceLocations(<span class="string"><span class="delimiter">&quot;</span><span class="content">/public/</span><span class="delimiter">&quot;</span></span>)
                                .resourceChain(<span class="predefined-constant">true</span>)
                                .addResolver(<span class="keyword">new</span> VersionResourceResolver().addContentVersionStrategy(<span class="string"><span class="delimiter">&quot;</span><span class="content">/**</span><span class="delimiter">&quot;</span></span>));
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>ResourceUrlProvider</code> to rewrite URLs and apply the full chain of resolvers and
transformers&#8201;&#8212;&#8201;e.g. to insert versions. The WebFlux config provides a <code>ResourceUrlProvider</code>
so it can be injected into others.</p>
</div>
<div class="paragraph">
<p>Unlike Spring MVC at present in WebFlux there is no way to transparely rewrite static
resource URLs since the are no view technologies that can make use of a non-blocking chain
of resolvers and transformers (e.g. resources on Amazon S3). When serving only local
resources the workaround is to use <code>ResourceUrlProvider</code> directly (e.g. through a custom
tag) and block for 0 seconds.</p>
</div>
<div class="paragraph">
<p><a href="http://www.webjars.org/documentation">WebJars</a> is also supported via <code>WebJarsResourceResolver</code>
and automatically registered when <code>"org.webjars:webjars-locator"</code> is present on the
classpath. The resolver can re-write URLs to include the version of the jar and can also
match to incoming URLs without versions&#8201;&#8212;&#8201;e.g. <code>"/jquery/jquery.min.js"</code> to
<code>"/jquery/1.2.0/jquery.min.js"</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-config-path-matching"><a class="anchor" href="#webflux-config-path-matching"></a>1.6.9. Path Matching</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-path-matching">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p>Spring WebFlux uses parsed representation of path patterns&#8201;&#8212;&#8201;i.e. <code>PathPattern</code>, and also
the incoming  request path&#8201;&#8212;&#8201;i.e. <code>RequestPath</code>, which eliminates the need to indicate
whether to decode the request path, or remove semicolon content, since <code>PathPattern</code>
can now access decoded path segment values and match safely.</p>
</div>
<div class="paragraph">
<p>Spring WebFlux also does not support suffix pattern matching so effectively there are only two
minor options to customize related to path matching&#8201;&#8212;&#8201;whether to match trailing slashes
(<code>true</code> by default) and whether the match is case-sensitive (<code>false</code>).</p>
</div>
<div class="paragraph">
<p>To customize those options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebFlux</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">implements</span> WebFluxConfigurer {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> configurePathMatch(PathMatchConfigurer configurer) {
                <span class="comment">// ...</span>
        }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webflux-config-advanced-java"><a class="anchor" href="#webflux-config-advanced-java"></a>1.6.10. Advanced config mode</h4>
<div class="paragraph">
<p><span class="small"><a href="web.html#mvc-config-advanced-java">Same in Spring MVC</a></span></p>
</div>
<div class="paragraph">
<p><code>@EnableWebFlux</code> imports <code>DelegatingWebFluxConfiguration</code> that (1) provides default
Spring configuration for WebFlux applications and (2) detects and delegates to
<code>WebFluxConfigurer</code>'s to customize that configuration.</p>
</div>
<div class="paragraph">
<p>For advanced mode, remove <code>@EnableWebFlux</code> and extend directly from
<code>DelegatingWebFluxConfiguration</code> instead of implementing <code>WebFluxConfigurer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">extends</span> DelegatingWebFluxConfiguration {

        <span class="comment">// ...</span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can keep existing methods in <code>WebConfig</code> but you can now also override bean declarations
from the base class and you can still have any number of other <code>WebMvcConfigurer</code>'s on
the classpath.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="webflux-client"><a class="anchor" href="#webflux-client"></a>1.7. WebClient</h3>
<div class="paragraph">
<p>The <code>spring-webflux</code> module includes a non-blocking, reactive client for HTTP requests
with Reactive Streams back pressure. It shares
<a href="#webflux-codecs">HTTP codecs</a> and other infrastructure with the
server <a href="#webflux-fn">functional web framework</a>.</p>
</div>
<div class="paragraph">
<p><code>WebClient</code> provides a higher level API over HTTP client libraries. By default
it uses <a href="https://github.com/reactor/reactor-netty">Reactor Netty</a> but that is pluggable
with a different <code>ClientHttpConnector</code>. The <code>WebClient</code> API returns Reactor <code>Flux</code> or
<code>Mono</code> for output and accepts Reactive Streams <code>Publisher</code> as input (see
<a href="#webflux-reactive-libraries">Reactive Libraries</a>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By comparison to the
<a href="integration.html#rest-resttemplate">RestTemplate</a>, the <code>WebClient</code> offers a more
functional and fluent API that taking full advantage of Java 8 lambdas. It supports both
sync and async scenarios, including streaming, and brings the efficiency of
non-blocking I/O.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="webflux-client-retrieve"><a class="anchor" href="#webflux-client-retrieve"></a>1.7.1. Retrieve</h4>
<div class="paragraph">
<p>The <code>retrieve()</code> method is the easiest way to get a response body and decode it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    WebClient client = WebClient.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.org</span><span class="delimiter">&quot;</span></span>);

    Mono&lt;Person&gt; result = client.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/persons/{id}</span><span class="delimiter">&quot;</span></span>, id).accept(MediaType.APPLICATION_JSON)
            .retrieve()
            .bodyToMono(Person.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also get a stream of objects decoded from the response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    Flux&lt;Quote&gt; result = client.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/quotes</span><span class="delimiter">&quot;</span></span>).accept(TEXT_EVENT_STREAM)
            .retrieve()
            .bodyToFlux(Quote.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, responses with 4xx or 5xx status codes result in an error of type
<code>WebClientResponseException</code> but you can customize that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    Mono&lt;Person&gt; result = client.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/persons/{id}</span><span class="delimiter">&quot;</span></span>, id).accept(MediaType.APPLICATION_JSON)
            .retrieve()
            .onStatus(HttpStatus::is4xxServerError, response -&gt; ...)
            .onStatus(HttpStatus::is5xxServerError, response -&gt; ...)
            .bodyToFlux(Person.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webflux-client-exchange"><a class="anchor" href="#webflux-client-exchange"></a>1.7.2. Exchange</h4>
<div class="paragraph">
<p>The <code>exchange()</code> method provides more control. The below example is equivalent
to <code>retrieve()</code> but also provides access to the <code>ClientResponse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    Mono&lt;Person&gt; result = client.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/persons/{id}</span><span class="delimiter">&quot;</span></span>, id).accept(MediaType.APPLICATION_JSON)
            .exchange()
            .flatMap(response -&gt; response.bodyToMono(Person.class));</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this level you can also create a full <code>ResponseEntity</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    Mono&lt;ResponseEntity&lt;Person&gt;&gt; result = client.get()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/persons/{id}</span><span class="delimiter">&quot;</span></span>, id).accept(MediaType.APPLICATION_JSON)
            .exchange()
            .flatMap(response -&gt; response.bodyToEntity(Person.class));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that unlike <code>retrieve()</code>, with <code>exchange()</code> there are no automatic error signals for
4xx and 5xx responses. You have to check the status code and decide how to proceed.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you use <code>exchange()</code>, you must call <code>response.close()</code> if you do not intend to read
the response body in order to close the underlying HTTP connection. Not doing so can
result in connection pool inconsistencies or memory leaks.</p>
</div>
<div class="paragraph">
<p>You do not have to call <code>response.close()</code> if you consume the body because forcing a
connection to be closed negates the benefits of persistent connections and connection
pooling.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="webflux-client-body"><a class="anchor" href="#webflux-client-body"></a>1.7.3. Request body</h4>
<div class="paragraph">
<p>The request body can be encoded from an Object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    Mono&lt;Person&gt; personMono = ... ;

    Mono&lt;<span class="predefined-type">Void</span>&gt; result = client.post()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/persons/{id}</span><span class="delimiter">&quot;</span></span>, id)
            .contentType(MediaType.APPLICATION_JSON)
            .body(personMono, Person.class)
            .retrieve()
            .bodyToMono(<span class="predefined-type">Void</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also have a stream of objects encoded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    Flux&lt;Person&gt; personFlux = ... ;

    Mono&lt;<span class="predefined-type">Void</span>&gt; result = client.post()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/persons/{id}</span><span class="delimiter">&quot;</span></span>, id)
            .contentType(MediaType.APPLICATION_STREAM_JSON)
            .body(personFlux, Person.class)
            .retrieve()
            .bodyToMono(<span class="predefined-type">Void</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or if you have the actual value, use the <code>syncBody</code> shortcut method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    Person person = ... ;

    Mono&lt;<span class="predefined-type">Void</span>&gt; result = client.post()
            .uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">/persons/{id}</span><span class="delimiter">&quot;</span></span>, id)
            .contentType(MediaType.APPLICATION_JSON)
            .syncBody(person)
            .retrieve()
            .bodyToMono(<span class="predefined-type">Void</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webflux-client-builder"><a class="anchor" href="#webflux-client-builder"></a>1.7.4. Builder options</h4>
<div class="paragraph">
<p>A simple way to create <code>WebClient</code> is through the static factory methods <code>create()</code> and
<code>create(String)</code> with a base URL for all requests. You can also use <code>WebClient.builder()</code>
for access to more options.</p>
</div>
<div class="paragraph">
<p>To customize the underlying HTTP client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    SslContext sslContext = ...

    ClientHttpConnector connector = <span class="keyword">new</span> ReactorClientHttpConnector(
            builder -&gt; builder.sslContext(sslContext));

    WebClient webClient = WebClient.builder()
            .clientConnector(connector)
            .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To customize the <a href="#webflux-codecs">HTTP codecs</a> used for encoding and
decoding HTTP messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    ExchangeStrategies strategies = ExchangeStrategies.builder()
            .codecs(configurer -&gt; {
                <span class="comment">// ...</span>
            })
            .build();

    WebClient webClient = WebClient.builder()
            .exchangeStrategies(strategies)
            .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The builder can be used to insert <a href="#webflux-client-filter">Filters</a>.</p>
</div>
<div class="paragraph">
<p>Explore the <code>WebClient.Builder</code> in your IDE for other options related to URI building,
default headers (and cookies), and more.</p>
</div>
<div class="paragraph">
<p>After the <code>WebClient</code> is built, you can always obtain a new builder from it, in order to
build a new <code>WebClient</code>, based on, but without affecting the current instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    WebClient modifiedClient = client.mutate()
            <span class="comment">// user builder methods...</span>
            .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webflux-client-filter"><a class="anchor" href="#webflux-client-filter"></a>1.7.5. Filters</h4>
<div class="paragraph">
<p><code>WebClient</code> supports interception style request filtering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    WebClient client = WebClient.builder()
        .filter((request, next) -&gt; {

                ClientRequest filtered = ClientRequest.from(request)
                    .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)
                    .build();

                <span class="keyword">return</span> next.exchange(filtered);
        })
        .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ExchangeFilterFunctions</code> provides a filter for basic authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// static import of ExchangeFilterFunctions.basicAuthentication</span>

    WebClient client = WebClient.builder()
        .filter(basicAuthentication(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">pwd</span><span class="delimiter">&quot;</span></span>))
        .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also mutate an existing <code>WebClient</code> instance without affecting the original:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    WebClient filteredClient = client.mutate()
            .filter(basicAuthentication(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">pwd</span><span class="delimiter">&quot;</span></span>)
            .build();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="webflux-reactive-libraries"><a class="anchor" href="#webflux-reactive-libraries"></a>1.8. Reactive Libraries</h3>
<div class="paragraph">
<p>Reactor is a required dependency for the <code>spring-webflux</code> module and is used internally
for composing logic and for Reactive Streams support. An easy rule to remember is that
WebFlux APIs return <code>Flux</code> or <code>Mono</code>&#8201;&#8212;&#8201;since that&#8217;s what&#8217;s used internally, and
leniently accept any Reactive Streams <code>Publisher</code> implementation.</p>
</div>
<div class="paragraph">
<p>The use of <code>Flux</code> and <code>Mono</code> helps to express cardinality&#8201;&#8212;&#8201;e.g.
whether a single or multiple async values are expected. This is important for API design
but also essential in some cases, e.g. when encoding an HTTP message.</p>
</div>
<div class="paragraph">
<p>For annotated controllers, WebFlux adapts transparently to the reactive library in use
with proper translation of cardinality. This is done with the help of the
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.RELEASE/javadoc-api/org/springframework/core/ReactiveAdapterRegistry.html">ReactiveAdapterRegistry</a> from
<code>spring-core</code> which provides pluggable support for reactive and async types. The registry
has built-in support for RxJava and <code>CompletableFuture</code> but others can be registered.</p>
</div>
<div class="paragraph">
<p>For functional endpoints, the <code>WebClient</code>, and other functional APIs, the general rule
of thumb for WebFlux APIs applies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Flux</code> or <code>Mono</code> as return values&#8201;&#8212;&#8201;use them to compose logic or pass to any Reactive
Streams library (both are <code>Publisher</code> implementations).</p>
</li>
<li>
<p>Reactive Streams <code>Publisher</code> for input&#8201;&#8212;&#8201;if a <code>Publisher</code> from another reactive library
is provided it can only be treated as a stream with unknown semantics (0..N). If the
semantics are known&#8201;&#8212;&#8201;e.g. <code>io.reactivex.Single</code>, you can use <code>Mono.from(Publisher)</code> and
pass that in instead of the raw <code>Publisher</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For example, given a <code>Publisher</code> that is not a <code>Mono</code>, the Jackson JSON message writer
expects multiple values. If the media type implies an infinite stream&#8201;&#8212;&#8201;e.g.
<code>"application/json+stream"</code>, values are written and flushed individually; otherwise
values are buffered into a list and rendered as a JSON array.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 5.0.0.RELEASE<br>
Last updated 2017-09-28 11:00:47 UTC
</div>
</div>
<script>
    var rootLink = document.createElement("a");
    rootLink.setAttribute("href", "index.html");
    rootLink.innerHTML = "<i class=\"fa fa-chevron-left\" aria-hidden=\"true\"></i>&nbsp;&nbsp;Back to index";
    var p = document.createElement("p");
    p.appendChild(rootLink);
    var toc = document.getElementById('toc')
    var sectlevel1 = toc.getElementsByClassName("sectlevel1")[0]
    toc.insertBefore(p,  sectlevel1);
</script>
</body>
</html>